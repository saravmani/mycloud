# Discussion on Docker File and Docker Compose File
###### Discussion on Docker File and Docker Compose File


###### Docker File
- It basically a configuration file. Which contains information about
*Dependences, What to do? How to do etc.,*. We can say Docker file helps to dockerize a given application
- Mostly It contains 2 parts
  * Building the application
  * Run the application



To Orchestrate we need a docker-compose file
  - docker-compose.yml
  - docker-compose.override.yml
    *It can contain configuration overrides for existing services or entirely new services. The use case for multiple files is based on the environment we can have multiple override files*

  ###### Sample docker-compose.yml file for .net core WebApi project
  ```ini
  version: '3.4'

services:
    bloggerDocDB:
        image: mongo

    bloggerservice:
        image: ${DOCKER_REGISTRY-}bloggerservice
        build:
          context: .
          dockerfile: BloggerService/Dockerfile
volumes: # it specifies the storage outside of the container. In our case, if the container restarts then mongo DB data or other data will get lost.
            #if it needs to be persisted we can use volumes. This data will get stored in the hosting machine. Even if the image has removed and recreated this data will be available in the host machine
    mongo_data:
  ```

  ###### Sample docker-compose.override.yml file for .net core webapi project
 ```ini
version: '3.4'
services:
    bloggerdb:
        container_name: bloggerdb
        restart: always
        #Always restarts the applicatoin in case of ERROR
            volumes:
                - ${WEBAPP_STORAGE_HOME}/SITE:/data/db
                # Store the data which is generated by container. It is a permenant storage
            ports:
               -"27017:27017"

    bloggerservice:
        environment:
          - ASPNETCORE_ENVIRONMENT=Development
          -"DBSettings:ConnectionString=mongodb://bloggerdb:27017"
          # Note here *bloggerdb* is actually a container name
          # Within docker env. we have to use container name and *Actual* port
        depends_on:
           - bloggerdb
           # This means the second container WILL NOT wait till the first container started completely. it just says the order
         volumes:
            - ${HOME}/.microsoft/usersecrets/:/root/.microsoft/usersecrets
            - ${HOME}/.aspnet/https:/root/.aspnet/https/
        ports:
          - "5000:80"


  ```
> *Note - Docker environment-specific,  settings can be overridden under **Environment Section**
*Example - In a Normal environment (Without a container), we may connect to other services with local ports. But within the Docker environment, the ports can be different*

###### To run and stop Docker compose file
```powershell
docker-compose -f docker-compose.yml  -f docker-compose.override.yml up -d
# -d to run in background
# Here based on env we can pass the override filename

docker-compose -f docker-compose.yml  -f docker-compose.override.yml down -d
```


###### To Build or rebuild services
If you change Code/Configurations etc then run below command to rebuild.
But docker file updates we no need to call build command.
```powershell
docker-compose -f docker-compose.yml  -f docker-compose.override.yml up --build
```



[//]: # (Tags: About dockerfile, docker-compose file, containerize )
[//]: # (Type: Docker - containerize)
[//]: # (Rating: 2)
[//]: # (Languages:powershell)
[//]: # (ReadyState:Publish)
